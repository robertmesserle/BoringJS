/*! RecoilJS (Alpha) by Robert Messerle  |  https://github.com/robertmesserle/RecoilJS */
/*! This work is licensed under the Creative Commons Attribution 3.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by/3.0/. */

!function(root,$){var DirtyCheck;DirtyCheck=function(){function DirtyCheck(){return this.constructor.instance?this.constructor.instance:(this.constructor.instance=this,this.bindEvents(),this.overwriteEventListeners(),void this.overwriteTimeouts())}return DirtyCheck.originalMethods={},DirtyCheck.instance=null,DirtyCheck.lastCheck=0,DirtyCheck.timeout=null,DirtyCheck.update=function(){var callback,now,waitTime,_this=this;if(!this.timeout)return now=+new Date,waitTime=now-this.lastCheck,this.lastCheck=now,waitTime>Recoil.throttle&&(waitTime=0),callback=function(){var binding,set,_i,_len,_ref,_results;for(_this.timeout=null,_ref=[{type:"write",method:"write"},{type:"read",method:"update"}],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)set=_ref[_i],_results.push(function(){var _j,_len1,_ref1,_results1;for(_ref1=Recoil.bindings[set.type],_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)binding=_ref1[_j],_results1.push(binding[set.method]());return _results1}());return _results},waitTime?this.timeout=this.originalMethods.setTimeout(callback,waitTime):callback()},DirtyCheck.prototype.elementList="undefined"!=typeof InstallTrigger?[HTMLAnchorElement,HTMLAppletElement,HTMLAreaElement,HTMLAudioElement,HTMLBaseElement,HTMLBodyElement,HTMLBRElement,HTMLButtonElement,HTMLCanvasElement,HTMLDataListElement,HTMLDirectoryElement,HTMLDivElement,HTMLDListElement,HTMLElement,HTMLEmbedElement,HTMLFieldSetElement,HTMLFontElement,HTMLFormElement,HTMLFrameElement,HTMLFrameSetElement,HTMLHeadElement,HTMLHeadingElement,HTMLHtmlElement,HTMLHRElement,HTMLIFrameElement,HTMLImageElement,HTMLInputElement,HTMLLabelElement,HTMLLegendElement,HTMLLIElement,HTMLLinkElement,HTMLMapElement,HTMLMediaElement,HTMLMenuElement,HTMLMetaElement,HTMLMeterElement,HTMLModElement,HTMLObjectElement,HTMLOListElement,HTMLOptGroupElement,HTMLOptionElement,HTMLOutputElement,HTMLParagraphElement,HTMLParamElement,HTMLPreElement,HTMLProgressElement,HTMLQuoteElement,HTMLScriptElement,HTMLSelectElement,HTMLSourceElement,HTMLSpanElement,HTMLStyleElement,HTMLTableElement,HTMLTableCaptionElement,HTMLTableColElement,HTMLTableRowElement,HTMLTableSectionElement,HTMLTextAreaElement,HTMLTitleElement,HTMLUListElement,HTMLUnknownElement,HTMLVideoElement]:[Element],DirtyCheck.prototype.getListener=function(originalMethod){return function(type,listener){var args;return args=Array.apply(null,arguments),args[1]=function(){return listener.apply(null,arguments),type.indexOf("down")>=0?setTimeout(function(){return DirtyCheck.update()}):DirtyCheck.update()},originalMethod.apply(this,args)}},DirtyCheck.prototype.overwriteEventListeners=function(){var originalMethod,type,_i,_len,_ref,_results;for(_ref=this.elementList,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)type=_ref[_i],originalMethod=type.prototype.addEventListener,originalMethod&&(type.prototype.addEventListener=this.getListener(originalMethod)),originalMethod=type.prototype.attachEvent,_results.push(originalMethod?type.prototype.attachEvent=this.getListener(originalMethod):void 0);return _results},DirtyCheck.prototype.overwriteTimeouts=function(){var func,originalMethod,_i,_len,_ref,_results,_this=this;for(_ref=["setTimeout","setInterval"],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)func=_ref[_i],originalMethod=root[func],_results.push(function(originalMethod){return _this.constructor.originalMethods[func]=function(){return originalMethod.apply(root,arguments)},root[func]=function(func){var args;return args=Array.apply(null,arguments),args[0]=function(){return func.apply(null,arguments),DirtyCheck.update()},originalMethod.apply(root,args)}}(originalMethod));return _results},DirtyCheck.prototype.bindEvents=function(){return $(function(){return $(document).ajaxComplete(function(){return DirtyCheck.update()}).on("load","script",function(){return DirtyCheck.update()}).on("click keydown","label",function(){return setTimeout(function(){return DirtyCheck.update()})})})},DirtyCheck}();var DataType;DataType=function(){function DataType(data,context){null==data&&(data={}),this.context=context,this.parseData(data)}return DataType.prototype.type=null,DataType.prototype["default"]=null,DataType.prototype.value=null,DataType.prototype.valid=!0,DataType.prototype.parseType=function(type){var typeString,_ref;return type?(typeString=type.toString(),typeString.indexOf("[native code]")+1?type:(null!=type?null!=(_ref=type.__super__)?_ref.constructor:void 0:void 0)===BaseModel?function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(type,arguments,function(){})}:(type=type(),function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(type,arguments,function(){})})):function(value){return value}},DataType.prototype.parseData=function(data){return this.type=this.parseType(data.type),this._validate=data.validate||function(){return!0},this._subscribe=data.subscribe||function(){return!0}},DataType.prototype.validate=function(){return this._validate.call(this.context,this.value)},DataType}();var BaseModel;BaseModel=function(){function BaseModel(data){null==data&&(data={}),this._createBuckets(),this._storeItem(),this._wrapProps(),this._createVirtuals(),this.set(data,null,!0,!1),this.save(),this._parseValidates(),this._parseSubscribes(),"function"==typeof this.initialize&&this.initialize(data)}return BaseModel.getByField=function(field,value){var item,_i,_len,_ref;for(_ref=this.items,_i=0,_len=_ref.length;_len>_i;_i++)if(item=_ref[_i],item[field]===value)return item},BaseModel.load=function(id,callback){var _this=this;return null!=id?this.loadOne(id,callback):$.ajax({url:this.paths.root(),success:function(data){var field,item,match,model,value,_i,_len;for(_i=0,_len=data.length;_len>_i;_i++)if(item=data[_i],match=_this.getByField("id",item.id),null!=match){for(field in data)value=data[field],match[field]=value;match.isNew=!1}else model=new _this(item),model.isNew=!1;return"function"==typeof callback?callback(_this.items):void 0}})},BaseModel.loadOne=function(id,callback){var _this=this;return $.ajax({url:this.paths.get.call({id:id}),success:function(data){var item;return item=new _this(data),"function"==typeof callback?callback(item):void 0}})},BaseModel.prototype.isNew=!0,BaseModel.prototype.hasChanged=!1,BaseModel.prototype._createBuckets=function(){return this.props={},this.virtuals={}},BaseModel.prototype._storeItem=function(){return this.constructor.items.push(this)},BaseModel.prototype._wrapProps=function(){var key,prop,_ref,_results;_ref=this.$props||{},_results=[];for(key in _ref)prop=_ref[key],this.props[key]=new Property(prop,this.context),_results.push(this[key]=this.props[key].value);return _results},BaseModel.prototype._createVirtuals=function(){var key,prop,virtual,_ref,_results;_ref=this.$virtual||{},_results=[];for(key in _ref)prop=_ref[key],this.virtuals[key]=virtual=new Virtual(prop,this),_results.push(this[key]=virtual.value);return _results},BaseModel.prototype._parseValidates=function(){var key,value,_ref,_results;_ref=this.$validate,_results=[];for(key in _ref)value=_ref[key],_results.push(this.props[key]._validate=value);return _results},BaseModel.prototype._parseSubscribes=function(){var key,value,_ref,_results;_ref=this.$subscribe,_results=[];for(key in _ref)value=_ref[key],_results.push(this.props[key]._subscribe=value);return _results},BaseModel.prototype.set=function(key,value,update,subscribe){var obj;if(null==update&&(update=!0),null==subscribe&&(subscribe=!0),"object"==typeof key){obj=key;for(key in obj)value=obj[key],this.set(key,value,!1,subscribe);if(update)return this.update()}else if(this[key]!==value)if(subscribe&&(this.hasChanged=!0),this.props[key]){if(this[key]=this.props[key].set(value,subscribe),update)return this.updateVirtuals()}else if(this.virtuals[key]&&(this[key]=this.virtuals[key].set(value,subscribe),update))return this.checkProps()},BaseModel.prototype.unset=function(key){return this[key]=this.props[key].unset()},BaseModel.prototype.revert=function(){var key,prop,_ref,_results;_ref=this.props,_results=[];for(key in _ref)prop=_ref[key],this[key]=prop.revert(),_results.push(this.updateVirtuals());return _results},BaseModel.prototype.validate=function(){var key,prop,_ref;_ref=this.props;for(key in _ref)if(prop=_ref[key],!prop.validate())return!1;return!0},BaseModel.prototype.escape=function(key){return this[key].replace(/</g,"&lt;").replace(/>/g,"&gt;")},BaseModel.prototype.save=function(){var key,prop,_ref;if(!this.validate())return!1;_ref=this.props;for(key in _ref)prop=_ref[key],prop.save();return this.send(),!0},BaseModel.prototype.send=function(){var ajax,url,_this=this;return(url=this.isNew?this.constructor.paths.post.call(this):this.constructor.paths.put.call(this))?(ajax={url:url,data:this.toJSON(),type:this.isNew?"POST":"PUT",success:function(data){var key,value;if(_this.isNew=!1,!data)return!1;for(key in data)value=data[key],null!=_this.props[key]&&(_this[key]=_this.props[key].set(value));return _this.updateVirtuals()}},$.ajax(ajax),ajax):void 0},BaseModel.prototype.fetch=function(){return $.ajax({url:this.constructor.paths.get.call(this),complete:function(data){return this.set(data)}})},BaseModel.prototype.checkVirtuals=function(){var key,virtual,_ref,_results;_ref=this.virtuals,_results=[];for(key in _ref)virtual=_ref[key],this[key]!==virtual.value&&_results.push(this[key]=virtual.set(this[key]));return _results},BaseModel.prototype.checkProps=function(){var key,prop,_ref;_ref=this.props;for(key in _ref)prop=_ref[key],this[key]!==prop.value&&(this[key]=prop.set(this[key]),this.hasChanged=!0);return this.updateVirtuals()},BaseModel.prototype.updateVirtuals=function(){var key,virtual,_ref,_results;_ref=this.virtuals,_results=[];for(key in _ref)virtual=_ref[key],_results.push(this[key]=virtual.update());return _results},BaseModel.prototype.toJSON=function(){var json,key,prop,_ref,_ref1;json={},_ref=this.props;for(key in _ref)prop=_ref[key],json[key]=(null!=(_ref1=prop.value)?"function"==typeof _ref1.toJSON?_ref1.toJSON():void 0:void 0)||prop.value;return json},BaseModel.prototype.update=function(){return this.checkVirtuals(),this.checkProps()},BaseModel.prototype.clone=function(){return new this.constructor(this.toJSON())},BaseModel}();var Collection,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;Collection=function(_super){function Collection(){Collection.__super__.constructor.apply(this,arguments),this.value=[],this.savedValue=[],this.addArrayMethods()}return __extends(Collection,_super),Collection.prototype.addArrayMethods=function(){var method,_i,_len,_ref,_results,_this=this;for(_ref="push pop unshift shift indexOf slice splice".split(/\s/),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)method=_ref[_i],_results.push(function(method){return _this[method]=function(){var _ref1;return(_ref1=_this.value)[method].apply(_ref1,arguments)}}(method));return _results},Collection.prototype.save=function(){var _ref;return console.log("saving"),this.validate()?(console.log("validated"),console.log(this.savedValue,this.value),(_ref=this.savedValue).splice.apply(_ref,[0,this.savedValue.length].concat(__slice.call(this.value))),console.log(this.savedValue)):void 0},Collection.prototype.revert=function(){var _ref;return(_ref=this.value).splice.apply(_ref,[0,this.value.length].concat(__slice.call(this.savedValue.slice())))},Collection.prototype.find=function(criteria){var index,item,_i,_len,_ref;if(index=this.value.indexOf(criteria),!(0>index))return this.value[index];if("function"==typeof criteria)for(_ref=this.value,_i=0,_len=_ref.length;_len>_i;_i++)if(item=_ref[_i],criteria(item))return item},Collection}(DataType);var Model,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Model=function(){function Model(meta){var _ref;return this.meta=null!=meta?meta:{},this.extendMeta(),this.model=function(_super){function model(){return _ref=model.__super__.constructor.apply(this,arguments)}return __extends(model,_super),model}(BaseModel),this.attachMeta(),this.attachStatic(),this.attachBuckets(),this.initPaths(),this.constructor.models.push(this.model),this.model}return Model.models=[],Model.prototype.extendMeta=function(){return this.meta.$extend?this.meta=$.extend(!0,{},this.meta.$extend._meta,this.meta):void 0},Model.prototype.attachStatic=function(){var key,prop,_ref,_results,_this=this;_ref=this.meta.$static||{},_results=[];for(key in _ref)prop=_ref[key],_results.push(function(key,prop){return _this.model[key]="function"==typeof prop?function(){return prop.apply(_this.model,arguments)}:prop}(key,prop));return _results},Model.prototype.attachMeta=function(){var key,value,_ref,_results;this.model._meta=this.meta,_ref=this.meta,_results=[];for(key in _ref)value=_ref[key],_results.push(this.model.prototype[key]=value);return _results},Model.prototype.attachBuckets=function(){return this.model.items=[]},Model.prototype.initPaths=function(){var $path,$paths,pathString,paths,rootPath;return $path=this.meta.$path,$paths=this.meta.$paths,rootPath=$path||(null!=$paths?$paths.root:void 0),"function"!=typeof rootPath&&(pathString=rootPath,rootPath=function(){return pathString}),paths={root:rootPath,get:function(){return""+paths.root.call(this.model)+"/"+this.id},put:function(){return paths.get.call(this)},post:function(){return paths.root.call(this.model)},"delete":function(){return paths.get.call(this)}},this.model.paths=paths},Model}();var Property,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Property=function(_super){function Property(){return _ref=Property.__super__.constructor.apply(this,arguments)}return __extends(Property,_super),Property.prototype["default"]=null,Property.prototype.parseType=function(type){var typeString,_ref1;return type?(typeString=type.toString(),typeString.indexOf("[native code]")+1?type:(null!=type?null!=(_ref1=type.__super__)?_ref1.constructor:void 0:void 0)===BaseModel?function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(type,arguments,function(){})}:(type=type(),function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(type,arguments,function(){})})):function(value){return value}},Property.prototype.parseData=function(data){return Property.__super__.parseData.apply(this,arguments),null!=data["default"]&&(this["default"]=this.type(data["default"])),this.value=this.savedValue=this["default"]},Property.prototype.set=function(value,subscribe){return null==subscribe&&(subscribe=!0),subscribe&&this._subscribe.call(this.context,value,this.value),this.value=this.type instanceof Recoil.Model?new this.type(value):this.type(value)},Property.prototype.unset=function(){return this.value=this["default"]},Property.prototype.save=function(){return this.validate()?this.savedValue=this.value:void 0},Property.prototype.revert=function(){return this.value=this.savedValue},Property}(DataType);var Virtual;Virtual=function(){function Virtual(meta,context){this.meta=meta,this.context=context,this.update()}return Virtual.prototype.set=function(value){var _ref;return null!=(_ref=this.meta.write)&&_ref.call(this.context,value),this.update()},Virtual.prototype.get=function(){var _ref;return this.value=null!=(_ref=this.meta.read)?_ref.call(this.context):void 0},Virtual.prototype.update=function(){return this.get()},Virtual}();var Router,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Router=function(){function Router(){this.handleChange=__bind(this.handleChange,this),this.bindEvent()}return Router.getInstance=function(){return null!=this.instance?this.instance:this.instance=new Router},Router.prototype.event="hashchange",Router.prototype.routes=[],Router.prototype.defaultRoute=null,Router.prototype.bindEvent=function(){return $(window).on("hashchange",this.handleChange)},Router.prototype.handleChange=function(){var hash,ret,route,_i,_len,_ref,_ref1;for(hash=location.hash.replace(/^#/,""),_ref=this.routes.sort(function(a,b){return b.path.length-a.path.length}),_i=0,_len=_ref.length;_len>_i;_i++)if(route=_ref[_i],route.regex.test(hash))return ret=route.handler(this.getParams(hash,route)),DirtyCheck.update(),ret;return ret=null!=(_ref1=this.defaultRoute)?_ref1.handler(hash):void 0,DirtyCheck.update(),ret},Router.prototype.getRegex=function(path){var index,part,parts,_i,_len;for(parts=path.split("/"),index=_i=0,_len=parts.length;_len>_i;index=++_i)part=parts[index],parts[index]=":"===part.charAt(0)?"[^\\/]+":part.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^"+parts.join("\\/"))},Router.prototype.mapDefaultRoute=function(handler){return this.defaultRoute={handler:handler}},Router.prototype.mapRoute=function(path,handler){var key,p,route,value,_i,_len,_results,_results1;if(path instanceof Array){for(_results=[],_i=0,_len=path.length;_len>_i;_i++)p=path[_i],_results.push(this.mapRoute(p,handler));return _results}if("object"==typeof path){_results1=[];for(key in path)value=path[key],_results1.push(this.mapRoute(key,value));return _results1}return route={regex:this.getRegex(path),path:path,handler:handler},this.routes.push(route)},Router.prototype.getParams=function(hash,route){var hashParts,index,params,part,routeParts,_i,_len;for(params={},hashParts=hash.split("/"),routeParts=route.path.split("/"),index=_i=0,_len=routeParts.length;_len>_i;index=++_i)part=routeParts[index],":"===part.charAt(0)&&(params[part.substring(1)]=hashParts[index]);return params.$rest=hashParts.slice(routeParts.length).join("/"),params},Router}();var Recoil,__slice=[].slice;Recoil=function(){function Recoil(){var args,controller,_i,_this=this;if(args=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),controller=arguments[_i++],this.controller=controller,Recoil.app)throw"You may only have one app running at a time.";$(function(){var $element;return new DirtyCheck,$element=$("[data-app='"+args[0]+"'], [data-app], body").eq(0),Recoil.app=new Core($element,_this.controller)})}return Recoil.app=null,Recoil.viewPath="./views",Recoil.throttle=30,Recoil.bindings={read:[],write:[]},Recoil.views={},Recoil.transitions={intro:{},outro:{}},Recoil.events="blur focus focusin focusout load resize scroll unload click\ndblclick mousedown mouseup mousemove mouseover mouseout mouseenter\nmouseleave change select submit keydown keypress keyup error".split(/\s+/g),Recoil.eval=function(func){return eval(func.toString())},Recoil.init=function(){return function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(Recoil,arguments,function(){})},Recoil.Property=Property,Recoil.Collection=Collection,Recoil.Model=Model,Recoil.mapRoute=function(){var _ref;return(_ref=Router.getInstance()).mapRoute.apply(_ref,arguments)},Recoil.mapDefaultRoute=function(){var _ref;return(_ref=Router.getInstance()).mapDefaultRoute.apply(_ref,arguments)},Recoil.triggerRouteChange=function(){return Router.getInstance().handleChange()},Recoil.createTransition=function(type,id,callback){return Recoil.transitions[type][id]=callback},Recoil.setViewPath=function(viewPath){this.viewPath=viewPath},Recoil.setMaxUpdateFrequency=function(throttle){this.throttle=throttle},Recoil.compile=function(str){var exp;return("undefined"!=typeof CoffeeScript&&null!==CoffeeScript?CoffeeScript.compile:void 0)?CoffeeScript.compile("do -> "+str,{bare:!0}):(exp=/.#\{([^\}]*[^\\])\}/g,str=str.replace(/\n/g,"\\n"),str=str.replace(exp,function(match,expression){var firstChar;return firstChar=match.charAt(0),"\\"===firstChar?match:""+firstChar+'" + ( '+expression+' ) + "'}),"( function () { return "+str+"; } )()")},Recoil}();var Base;Base=function(){function Base(){this.logic=null!=this.context.$element.data("logic"),(this.logic||this["if"])&&this.insertPlaceholder(),this.pushBinding()}return Base.prototype.getBindings=function(){var bindings,_ref,_ref1;return bindings=null!=(_ref=this.context.extras)?null!=(_ref1=_ref.parentBinding)?_ref1.bindings:void 0:void 0,null==bindings&&(bindings=Recoil.bindings),bindings},Base.prototype.pushBinding=function(){var bindings;if(null==this.context.$element.data("static"))return bindings=this.getBindings(),this.update&&bindings.read.push(this),this.write?bindings.write.push(this):void 0},Base.prototype.parseBinding=function(binding,evalFunction){var jsBinding;return null==evalFunction&&(evalFunction=!0),null==this.cachedBindings&&(this.cachedBindings={}),(jsBinding=this.cachedBindings[binding])?jsBinding.call(this):(this.cachedBindings[binding]=this.generateFunction(binding),evalFunction?this.cachedBindings[binding].call(this):this.cachedBindings[binding])},Base.prototype.cleanParentBindings=function(){var bindings,element,index,_i,_ref,_ref1,_ref2,_results;for(bindings=this.getBindings(),_results=[],index=_i=_ref=bindings.length-1;0>=_ref?0>=_i:_i>=0;index=0>=_ref?++_i:--_i)element=(null!=(_ref1=binding.context.$placeholder)?_ref1.get(0):void 0)||(null!=(_ref2=binding.context.$element)?_ref2.get(0):void 0),_results.push($.contains(document.body,element)?void 0:bindings.splice(index,1));return _results},Base.prototype.removeBinding=function(){var bindings,index,_ref,_ref1;return bindings=null!=(_ref=this.context.extras)?null!=(_ref1=_ref.parentBinding)?_ref1.bindings:void 0:void 0,null==bindings&&(bindings=Recoil.bindings),index=bindings.read.indexOf(this),index+1?bindings.read.splice(index,1):void 0},Base.prototype.parseString=function(str){var jsString;return null==this.cachedStrings&&(this.cachedStrings={}),(jsString=this.cachedStrings[str])?jsString.call(this):(str=str.replace(/\"/g,'\\"'),str='"'+str+'"',this.cachedStrings[str]=this.generateFunction(str),this.cachedStrings[str].call(this))},Base.prototype.generateFunction=function(str,customArgs){var argHash,args,js,key,scopeArgs,value;null==customArgs&&(customArgs=[]),js=Recoil.compile(""+str),argHash={$element:"this.context.$element",$root:"this.context.root",$parent:"this.context.parent",$data:"this.context.scope",$scope:"this.context.scope",$extras:"this.context.extras"},args=[],scopeArgs=[];for(key in this.context.scope)isNaN(key)&&(argHash[key]="this.context.scope[ '"+key+"' ]");for(key in this.context.extras)isNaN(key)&&(argHash[key]="this.context.extras[ '"+key+"' ]");for(key in argHash)value=argHash[key],args.push(key),scopeArgs.push(value);return eval("( function ( "+customArgs.join(",")+" ) {\n  return ( function ( "+args.join(",")+" ) {\n    return "+js+"\n  } ).call( {}, "+scopeArgs.join(", ")+" )\n} )")},Base.prototype.updateBinding=function(value,binding){var part,parts,scope;return null==binding&&(binding=this.binding),parts=binding.split("."),part=parts.pop(),scope=this.parseBinding(parts.join("."))||this.context.scope,"function"==typeof scope[part]?scope[part](value):scope[part]=value},Base.prototype.insertPlaceholder=function(){var attr,str;if(!this.context.$placeholder)return str=function(){var _i,_len,_ref,_results;for(_ref=this.context.$element.get(0).attributes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)attr=_ref[_i],_results.push(""+attr.nodeName+"='"+attr.value+"'");return _results}.call(this).join(" "),this.context.$placeholder=$("<!-- RecoilJS: "+str+" -->").insertBefore(this.context.$element)},Base.prototype.wrap=function(){return this.context.unwrapped&&this.logic?(this.context.unwrapped=!1,this.context.$element.insertBefore(this.context.$contents),this.context.$contents.appendTo(this.context.$element)):void 0},Base.prototype.unwrap=function(){return!this.context.unwrapped&&this.logic?(this.context.unwrapped=!0,this.context.$contents=this.context.$element.contents().insertAfter(this.context.$element),this.context.$element.detach()):void 0},Base.prototype.checkBindings=function(){var binding,bindings,set,_i,_len,_ref,_results;if(this.bindings){for(_ref=[{type:"write",method:"write"},{type:"read",method:"update"}],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)set=_ref[_i],bindings=this.bindings[set.type],_results.push(function(){var _j,_len1,_ref1,_results1;for(_ref1=bindings.slice(0),_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)binding=_ref1[_j],_results1.push(binding[set.method]());return _results1}());return _results}},Base}();var AttributeText,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};AttributeText=function(_super){function AttributeText(context,attribute){return this.context=context,this.attribute=attribute,this.attribute?(this.template=this.attribute.nodeValue,void(this.attribute.nodeName.match(/^data/)||this.template.match("{")&&(this.updateValue(),this.pushBinding()))):this.parseAttributes()}return __extends(AttributeText,_super),AttributeText.prototype.parseAttributes=function(){var attribute,_i,_len,_ref,_results;for(_ref=this.context.$element.get(0).attributes||[],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)attribute=_ref[_i],_results.push(new AttributeText(this.context,attribute));return _results},AttributeText.prototype.updateValue=function(){var value;return value=this.parseString(this.template),this.value!==value?(this.value=value,this.attribute.nodeValue=value):void 0},AttributeText.prototype.update=function(){return this.updateValue()},AttributeText}(Base);var AttrBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};AttrBinding=function(_super){function AttrBinding(context){this.context=context,(this.binding=this.context.$element.data("attr"))&&(this.setValue(),AttrBinding.__super__.constructor.apply(this,arguments))}return __extends(AttrBinding,_super),AttrBinding.prototype.setValue=function(){var key,value;if(value=$.extend(!0,{},this.parseBinding(this.binding)),this.value!==value){if(this.value)for(key in this.value)this.value[key]="";return this.context.$element.attr($.extend(!0,this.value||{},value)),this.value=value}},AttrBinding.prototype.update=function(){return this.setValue()},AttrBinding}(Base);var ComposeBinding,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ComposeBinding=function(_super){function ComposeBinding(context){this.context=context,this.renderView=__bind(this.renderView,this),((this.binding=this.context.$element.data("compose"))||this.context.$element.data("view"))&&(this.context.skipChildren=!0,this.bindings={read:[],write:[]},this.binding&&(this.controller=this.parseBinding(this.binding)),this.view=this.getView(),this.view&&this.loadView(),ComposeBinding.__super__.constructor.apply(this,arguments))}return __extends(ComposeBinding,_super),ComposeBinding.prototype.getView=function(controller){var view;return null==controller&&(controller=this.controller),view=this.context.$element.data("view"),view?this.parseBinding(view):null!=controller?controller.view:void 0},ComposeBinding.prototype.loadView=function(){var url,_this=this;return url=""+Recoil.viewPath+"/"+this.view+".html",Recoil.views[url]?this.renderView(Recoil.views[url]):(this.loading=!0,$.ajax({url:url,success:function(data){return _this.loading=!1,data=Recoil.views[url]=data.replace(/<\$/g,'<div data-logic="true"').replace(/<\/\$>/g,"</div>"),_this.renderView(data)}}))},ComposeBinding.prototype.renderView=function(data){var intro,_ref,_ref1,_ref2;return null==data&&(data=this.html),null!=(_ref=this.controller)&&"function"==typeof _ref.beforeRender&&_ref.beforeRender(this.context.$element,this.context.parent,this.context.root),this.context.$element.scrollTop(0),this.html=data,this.bindings={read:[],write:[]},this.context.$element.html(this.html),this.parseChildren(),null!=(_ref1=this.controller)&&"function"==typeof _ref1.afterRender&&_ref1.afterRender(this.context.$element,this.context.parent,this.context.root),intro=Recoil.transitions.intro[this.view]||(null!=(_ref2=this.controller)?_ref2.intro:void 0)||null,"function"==typeof intro?intro(this.context.$element):void 0},ComposeBinding.prototype.parseChildren=function(){var _this=this;return this.context.$element.contents().each(function(index,element){var extras;return extras=$.extend({},_this.context.extras,{parentBinding:_this}),new Parser({$element:$(element),scope:_this.controller,parent:_this.context.scope,root:_this.context.root,extras:extras})})},ComposeBinding.prototype.update=function(){var callback,controller,outro,view,_ref,_this=this;if(!this.loading)return this.binding&&(controller=this.parseBinding(this.binding)),view=this.getView(controller),this.controller!==controller||this.view!==view?(outro=Recoil.transitions.outro[this.view]||(null!=(_ref=this.controller)?_ref.outro:void 0)||null,this.controller=controller,this.view=view,callback=function(){return _this.view?_this.loadView():void 0},("function"==typeof outro?outro(this.context.$element,callback):void 0)||callback()):this.checkBindings()},ComposeBinding}(Base);var ContextBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ContextBinding=function(_super){function ContextBinding(context){this.context=context,(this.binding=this.context.$element.data("context"))&&(this.$template=this.context.$element.contents().clone(),this.setValue(),ContextBinding.__super__.constructor.apply(this,arguments))}return __extends(ContextBinding,_super),ContextBinding.prototype.setValue=function(){var value;return value=this.parseBinding(this.binding),this.value!==value?(this.value=value,this.setChildContext()):void 0},ContextBinding.prototype.setChildContext=function(){return this.context.childContext={scope:this.value,parent:this.context.scope}},ContextBinding.prototype.update=function(){var value;return value=this.parseBinding(this.binding),this.value!==value?(this.context.$element.html(this.$template.clone()),this.removeBinding(),new Parser(this.context)):void 0},ContextBinding}(Base);var CSSBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};CSSBinding=function(_super){function CSSBinding(context){this.context=context,(this.binding=this.context.$element.data("css"))&&(this.updateCSS(),CSSBinding.__super__.constructor.apply(this,arguments))}return __extends(CSSBinding,_super),CSSBinding.prototype.updateCSS=function(){var cssString;
return this.css=this.parseBinding(this.binding),cssString=JSON.stringify(this.css),this.cssString!==cssString?this.context.$element.css(this.css):void 0},CSSBinding.prototype.update=function(){return this.updateCSS()},CSSBinding}(Base);var EventBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EventBinding=function(_super){function EventBinding(context,eventName){var csString,func,str,_this=this;return this.context=context,eventName?(str=this.context.$element.data(eventName),csString=""+str,func=this.parseBinding(csString,!1),eventName=""+eventName+".recoil",void this.context.$element.off(eventName).on(eventName,function(event){var ret,_ref;return ret=func.call(_this,event),"function"==typeof ret?ret(event,(null!=(_ref=_this.context.extras)?_ref.item:void 0)||_this.context.scope):ret})):this.parseEvents()}return __extends(EventBinding,_super),EventBinding.prototype.parseEvents=function(){var event,str,_i,_len,_ref,_results;for(_ref=Recoil.events,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],str=this.context.$element.data(event),str&&_results.push(new EventBinding(this.context,event));return _results},EventBinding.prototype.generateFunction=function(str){return EventBinding.__super__.generateFunction.call(this,str,["$event"])},EventBinding}(Base);var ForBinding,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ForBinding=function(_super){function ForBinding(context){this.context=context,this.updateItems=__bind(this.updateItems,this),this.checkForChanges=__bind(this.checkForChanges,this),(this.binding=this.context.$element.data("for"))&&(this.bindings={read:[],write:[]},this.context.skipChildren=!0,this.getParts(),this.getTemplate(),this.collection=this.getCollection(),this.wrap(),this.parseItems(this.collection),this.unwrap(),ForBinding.__super__.constructor.apply(this,arguments))}return __extends(ForBinding,_super),ForBinding.prototype.getParts=function(){var condition,itemParts,parts;return parts=this.binding.split(/\s+in\s+|\s+when\s+/g),itemParts=parts[0].split(","),this.itemName=$.trim(itemParts[0]),this.indexName=$.trim(itemParts[1]),this.collectionName=$.trim(parts[1]),condition=$.trim(parts[2]||"true"),this.conditionFunction=this.parseBinding(condition,!1)},ForBinding.prototype.getTemplate=function(){return this.$template=this.context.$element.contents().remove()},ForBinding.prototype.getCollection=function(){var index,item,items,key;if(items=this.parseBinding(this.collectionName),items="function"==typeof items?items():items,items instanceof Array)items=function(){var _i,_len,_results;for(_results=[],index=_i=0,_len=items.length;_len>_i;index=++_i)item=items[index],this.conditionFunction.call(this,item,index)&&_results.push(item);return _results}.call(this);else for(item in items)key=items[item],this.conditionFunction.call(this,item,key)||delete items[key];return items},ForBinding.prototype.parseItems=function(collection){var index,item,_i,_len,_results,_results1;if(null==collection&&(collection=this.getCollection()),collection instanceof Array){for(_results=[],index=_i=0,_len=collection.length;_len>_i;index=++_i)item=collection[index],_results.push(this.parseItem(item,index,collection));return _results}_results1=[];for(index in collection)item=collection[index],_results1.push(this.parseItem(item,index,collection));return _results1},ForBinding.prototype.parseItem=function(item,index,collection){var $item,extras;return $item=this.$template.clone().appendTo(this.context.$element),extras=$.extend({},this.context.extras),"object"==typeof item?(extras.itemName=this.itemName,extras.$item=item,extras[this.itemName]=item,extras[this.itemName].$index=index,extras[this.itemName].$total=collection.length):extras[this.itemName]=item,this.indexName&&(extras[this.indexName]=index),extras.parentBinding=this,new Parser({$element:$item,scope:this.context.scope,parent:this.context.parent,root:this.context.root,extras:extras})},ForBinding.prototype.generateFunction=function(str){var args;return args=[this.itemName],this.indexName&&args.push(this.indexName),ForBinding.__super__.generateFunction.call(this,str,args)},ForBinding.prototype.checkForChanges=function(collection){var index,item,_i,_len,_ref;if(!this.collection)return!0;if(collection.length!==this.collection.length)return!0;for(_ref=collection||[],index=_i=0,_len=_ref.length;_len>_i;index=++_i)if(item=_ref[index],item!==this.collection[index])return!0;return!1},ForBinding.prototype.updateItems=function(){var collection;return collection=this.getCollection(),this.checkForChanges(collection)?(this.wrap(),this.collection=collection.slice(0),this.bindings={read:[],write:[]},this.context.$element.empty(),this.parseItems(collection),this.unwrap()):this.checkBindings()},ForBinding.prototype.update=function(){return this.updateItems()},ForBinding}(Base);var HTMLBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};HTMLBinding=function(_super){function HTMLBinding(context){this.context=context,(this.binding=this.context.$element.data("html"))&&(this.setValue(),this.pushBinding())}return __extends(HTMLBinding,_super),HTMLBinding.prototype.setValue=function(){var value;return value=this.parseBinding(this.binding),this.value!==value?(this.value=value,this.context.$element.html(this.value)):void 0},HTMLBinding.prototype.update=function(){return this.setValue()},HTMLBinding}(Base);var IfBinding,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};IfBinding=function(_super){function IfBinding(context){this.context=context,this.reparse=__bind(this.reparse,this),null!=(this.binding=this.context.$element.data("if"))&&(this.checkForErrors(),IfBinding.__super__.constructor.apply(this,arguments),this.update(!1))}return __extends(IfBinding,_super),IfBinding.prototype["if"]=!0,IfBinding.prototype.checkForErrors=function(){if(this.context.$element.data("for"))throw'Recoil Error:  "data-for" and "data-if" cannot be used on the same element.'},IfBinding.prototype.reparse=function(){return this.wrap(),this.removeBinding(),new Parser(this.context),delete this.reparse},IfBinding.prototype.setValue=function(reparse){return null==reparse&&(reparse=!1),this.context.stopParsing=!this.value,this.value?(this.context.$element.insertAfter(this.context.$placeholder),reparse?this.reparse():void 0):(this.context.$element.detach(),this.cleanParentBindings())},IfBinding.prototype.update=function(reparse){var value;return null==reparse&&(reparse=!0),value=!!this.parseBinding(this.binding),this.value!==value?(this.value=value,this.wrap(),this.setValue(reparse),this.unwrap()):void 0},IfBinding}(Base);var InitBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};InitBinding=function(_super){function InitBinding(context){this.context=context,(this.binding=this.context.$element.data("init"))&&(this.csString="-> "+this.binding,this.func=this.parseBinding(this.csString,!1),this.func.call(this)(),InitBinding.__super__.constructor.apply(this,arguments))}return __extends(InitBinding,_super),InitBinding}(Base);var TextNode,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};TextNode=function(_super){function TextNode(context){this.context=context,3===this.context.$element.get(0).nodeType&&(this.template=this.context.$element.text())&&this.template.indexOf("{")+1&&(this.context.stopParsing=!0,this.element=this.context.$element.get(0),this.updateValue(),TextNode.__super__.constructor.apply(this,arguments))}return __extends(TextNode,_super),TextNode.prototype.updateValue=function(){var value;return value=this.parseString(this.template),this.value!==value?this.element.nodeValue=this.value=value:void 0},TextNode.prototype.update=function(){return this.updateValue()},TextNode}(Base);var UpdateBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};UpdateBinding=function(_super){function UpdateBinding(context){this.context=context,(this.binding=this.context.$element.data("update"))&&(this.csString="-> "+this.binding,this.func=this.parseBinding(this.csString,!1),this.func.call(this)(),UpdateBinding.__super__.constructor.apply(this,arguments))}return __extends(UpdateBinding,_super),UpdateBinding.prototype.update=function(){try{return this.func.call(this)()}catch(_error){}},UpdateBinding}(Base);var ValueBinding,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ValueBinding=function(_super){function ValueBinding(context){this.context=context,this.updateHandler=__bind(this.updateHandler,this),(this.binding=this.context.$element.data("value"))&&(this.context.skipChildren=!0,this.setValue(),this.context.$element.is("select")&&this.updateHandler(),this.bindEvents(),ValueBinding.__super__.constructor.apply(this,arguments))}return __extends(ValueBinding,_super),ValueBinding.prototype.bindEvents=function(){var events;return events="click keydown change",this.context.$element.on(events,$.noop)},ValueBinding.prototype.getValue=function(){var value;if("radio"!==this.context.$element.attr("type")||this.context.$element.is(":checked"))return value=this.parseBinding(this.binding),value=("function"==typeof value?value():void 0)||value},ValueBinding.prototype.setValue=function(){var value;if(value=this.getValue(),this.value!==value)switch(this.value=value,this.context.$element.attr("type")){case"checkbox":return this.context.$element.prop("checked",value);case"radio":break;default:return this.context.$element.val(this.value)}},ValueBinding.prototype.updateHandler=function(){var value;if(!this.context.$element.is(":radio")||this.context.$element.is(":checked"))return value=function(){switch(this.context.$element.attr("type")){case"checkbox":return this.context.$element.prop("checked");default:return this.context.$element.val()}}.call(this),this.value!==value?this.updateBinding(this.value=value):void 0},ValueBinding.prototype.update=function(){return this.setValue()},ValueBinding.prototype.write=function(){return this.updateHandler()},ValueBinding}(Base);var VisibleBinding,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};VisibleBinding=function(_super){function VisibleBinding(context){this.context=context,(this.binding=this.context.$element.data("visible"))&&(this.setValue(),VisibleBinding.__super__.constructor.apply(this,arguments))}return __extends(VisibleBinding,_super),VisibleBinding.prototype.setValue=function(){var value;return value=!!this.parseBinding(this.binding),this.value!==value?(this.value=value,this.value?this.context.$element.show():this.context.$element.hide()):void 0},VisibleBinding.prototype.update=function(){return this.setValue()},VisibleBinding}(Base);var Parser;Parser=function(){function Parser(context){var _this=this;this.context=context,this.context.$element.each(function(index,element){var $element;return $element=$(element),_this.parseNode($element)})}return Parser.prototype.bindings=[TextNode,IfBinding,AttributeText,EventBinding,AttrBinding,ContextBinding,CSSBinding,VisibleBinding,ComposeBinding,ForBinding,HTMLBinding,ValueBinding],Parser.prototype.parseNode=function($element){var $contents,binding,context,_i,_len,_ref;for(context={$element:$element,scope:this.context.scope,parent:this.context.parent,root:this.context.root,extras:this.context.extras},context.$element=$element,_ref=this.bindings,_i=0,_len=_ref.length;_len>_i;_i++){if(binding=_ref[_i],context.stopParsing)return;new binding(context)}return context.skipChildren?void 0:($contents=context.$contents||$element.contents(),$contents.each(function(index,element){return new Parser($.extend({},context,context.childContext,{$element:$(element)}))}),new UpdateBinding(context),new InitBinding(context))},Parser}();var Core,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Core=function(){function Core($element,controller){this.$element=$element,this.controller=controller,this.addComposition=__bind(this.addComposition,this),this.checkForLogicTags(),this.addComposition()}return Core.prototype.checkForLogicTags=function(){var html;return html=this.$element.html(),html.indexOf("&lt;$")+1?(html=html.replace(/&lt;\$(.*)&gt;/g,function(match,contents){return"<div data-logic "+contents+">"}),html=html.replace(/<!--\$-->/g,"</div>"),this.$element.html(html)):void 0},Core.prototype.addComposition=function(){return this.controller.view&&this.$element.data("compose","$scope"),new Parser({$element:this.$element,scope:this.controller,root:this.controller})},Core}(),"function"==typeof define&&define.amd?define(function(){return Recoil}):root.Recoil=Recoil}(this,jQuery);